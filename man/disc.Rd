% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/main_vanilla.R
\name{disc}
\alias{disc}
\title{Identify Deme Inbreeding Spatial Coefficients in Continuous Space}
\usage{
disc(
  discdat,
  start_params = NULL,
  lambda = 0.1,
  learningrate = 0.001,
  m_lowerbound = 0,
  m_upperbound = Inf,
  b1 = 0.9,
  b2 = 0.999,
  e = 1e-08,
  steps = 1000,
  thin = 1,
  normalize_geodist = TRUE,
  report_progress = TRUE,
  return_verbose = FALSE
)
}
\arguments{
\item{discdat}{dataframe; The genetic-geographic data by deme (K). Must contain columns:
\code{smpl1}, \code{smpl2}, \code{deme1}, \code{deme2}, \code{gendist}, \code{geodist}}

\item{start_params}{named double vector; vector of start parameters. Names must match deme names,
plus one parameter named "m" for migration rate}

\item{lambda}{double; A quadratic L2 regularization parameter on "m" parameter: \eqn{\lambda m^2}. Default: 0.1}

\item{learningrate}{double; Learning rate (alpha) for gradient descent optimization. Default: 0.001}

\item{m_lowerbound}{double; Lower bound for the migration parameter "m". Default: 0}

\item{m_upperbound}{double; Upper bound for the migration parameter "m". Default: Inf}

\item{b1}{double; Exponential decay rate for first moment estimate in Adam optimizer. Default: 0.9}

\item{b2}{double; Exponential decay rate for second moment estimate in Adam optimizer. Default: 0.999}

\item{e}{double; Small constant for numerical stability in Adam optimizer. Default: 1e-8}

\item{steps}{integer; Number of optimization steps. Default: 1000}

\item{thin}{integer; Thinning interval for stored iterations (1 = store all). Default: 1}

\item{normalize_geodist}{logical; Whether to normalize geographic distances to \link{0,1} using
min-max scaling: \eqn{X' = \frac{X - X_{min}}{X_{max} - X_{min}}}. Improves numerical
stability but complicates interpretation of migration rate. Default: TRUE}

\item{report_progress}{logical; Whether to display progress bar during optimization. Default: TRUE}

\item{return_verbose}{logical; Whether to return full optimization trajectory (TRUE) or just
final results (FALSE). Full trajectory can be memory intensive. Default: FALSE}
}
\value{
A list of class "DISCresult" containing:
\itemize{
\item \code{Final_Fis}: Final inbreeding coefficient estimates
\item \code{Final_m}: Final migration rate estimate
\item \code{deme_key}: Mapping of deme names to indices
\item \code{cost}: Final cost function value(s)
}
If \code{return_verbose = TRUE}, additional elements include:
\itemize{
\item \code{fi_run}: F parameter trajectory over iterations
\item \code{m_run}: Migration parameter trajectory
\item \code{fi_gradtraj}: F gradient trajectory
\item \code{m_gradtraj}: Migration gradient trajectory
\item \code{fi_1moment}, \code{fi_2moment}: F parameter Adam moments
\item \code{m_1moment}, \code{m_2moment}: Migration parameter Adam moments
}
}
\description{
This function estimates deme-specific inbreeding coefficients and a global migration
rate from genetic and geographic distance data using an isolation-by-distance model. The model
assumes that genetic similarity between samples decreases exponentially with geographic distance,
modulated by deme-specific inbreeding coefficients.

The gradient calculation has been optimized to ensure all deme pairs contribute symmetrically
to parameter updates, improving convergence and accuracy of estimates.
}
\details{
The input dataframe must have exactly these column names in order:
\itemize{
\item \code{smpl1}, \code{smpl2}: Sample identifiers
\item \code{deme1}, \code{deme2}: Deme (location) identifiers
\item \code{gendist}: Pairwise genetic distance \link{0,1}
\item \code{geodist}: Pairwise geographic distance
}

The \code{start_params} vector must contain:
\itemize{
\item One parameter per unique deme (named with deme identifiers)
\item One parameter named "m" for the migration rate
\item All F parameters must be in \link{0,1} (inbreeding coefficients)
}

Inbreeding coefficients (F) are constrained to be non-negative using logit transformation
internally. The optimization uses the Adam algorithm with adaptive moment estimation.

The model assumes: \eqn{E[r_{ij}] = \frac{F_i + F_j}{2} \exp(-d_{ij}/m)}
where \eqn{r_{ij}} is genetic relatedness, \eqn{F_i} is deme i's inbreeding coefficient,
\eqn{d_{ij}} is geographic distance, and \eqn{m} is the migration rate parameter.
}
